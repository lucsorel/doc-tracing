:revealjs_customtheme: assets/doc-tracing.css
:revealjs_progress: true
:revealjs_slideNumber: true
:source-highlighter: highlightjs
:icons: font
:toc:

= Doc-tracing

== Tra√ßage d'ex√©cution du code √† des fins documentaires

Outiller les discussions d'architecture avec des diagrammes d'ex√©cution des tests fonctionnels.


[.small]
*Luc Sorel-Giffo* -- jeudi 6 avril 2023 -- Soir√©e des communaut√©s techniques rennaises

[.small]
https://floss.social/@lucsorelgiffo[@lucsorelgiffo@floss.social]

== Gen√®se de l'id√©e : une approche compl√©mentaire du doc-as-code

* documenter une base de code, c'est bien
* √©crire de la documentation, c'est p√©nible / _improductif_
* maintenir de la documentation, c'est... rarement fait

`doc-as-code` :

* üéì √©crire la doc comme on √©crit du code (fichiers _texte_, DSL)
* üí° g√©n√©rer la doc √† partir du code !

[.columns]
=== Il y a 2 types de code dans le doc-as-code

[.column]
--

[.small]
Le code source (v√©rit√©)

[source,python]
----
# school.py
from dataclasses import \
    dataclass

@dataclass
class Person:
    firstname: str
    lastname: str

@dataclass
class Course:
    name: str
    teacher: Person

@dataclass
class Student(Person):
    courses: list[Course]
----
--

[.column]
--

[.small]
Le code de la doc (PlantUML, Asciidoc, etc.)

[source,plantuml]
----
# school.puml
@startuml school
class school.Course {
  name: str
  teacher: Person
}
class school.Person {
  firstname: str
  lastname: str
}
class school.Student {
  courses: list[Course]
}
school.Course *-- school.Person
school.Student *-- school.Course
school.Person <|-- school.Student
footer Generated by //py2puml//
@enduml
----
--

[.column]
--

[.small]
(le code des outils de g√©n√©ration et de rendu de la doc) +

[plantuml, target=class-diagram, format=svg]
----
@startuml school
class school.Course {
  name: str
  teacher: Person
}
class school.Person {
  firstname: str
  lastname: str
}
class school.Student {
  courses: list[Course]
}
school.Course *-- school.Person
school.Student *-- school.Course
school.Person <|-- school.Student
footer Generated by //py2puml//
@enduml
----
--

== Doc-as-code par analyse statique de code source

* diagramme de composants (organisation)
* diagramme de classes (domaine m√©tier)
** annotations de type
** docstring (javadoc, phpdoc, jsdoc)
* documentation d'API
** signature des fonctions et m√©thodes (param√®tres, valeur de retour)
** web : openAPI

[.notes]
--
il existe plein d'outils dans tous les langages
- https://github.com/NiklasRosenstein/pydoc-markdown
- https://pdoc3.github.io/pdoc/
- https://mkdocstrings.github.io/
- https://github.com/vemel/handsdown#-handsdown---python-documentation-generator
- https://pdoc.dev/
- https://github.com/davidenunes/mkgendocs#mkgendocs
- https://github.com/terrencepreilly/darglint#darglint
- https://github.com/PyCQA/pydocstyle/#pydocstyle---docstring-style-checker
- https://github.com/dadadel/pyment#pyment
- https://github.com/Carreau/velin#v%C3%A9lin
--

== Limites

* https://docs.python.org/3/library/trace.html#module-trace
* https://pymotw.com/2/trace/
* https://stackoverflow.com/questions/50558849/python-how-to-trace-function-execution-order-in-large-project
